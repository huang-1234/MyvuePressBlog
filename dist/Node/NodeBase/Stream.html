<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>理解 Stream（流） | FShsq</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
    <meta name="description" content="From FE Arch、To Full Stack">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.1a00f748.css" as="style"><link rel="preload" href="/assets/js/app.685bc563.js" as="script"><link rel="preload" href="/assets/js/3.20a26f39.js" as="script"><link rel="preload" href="/assets/js/1.027a0825.js" as="script"><link rel="preload" href="/assets/js/188.01a616f2.js" as="script"><link rel="prefetch" href="/assets/js/10.22cbef87.js"><link rel="prefetch" href="/assets/js/100.19c41c6d.js"><link rel="prefetch" href="/assets/js/101.4d43e653.js"><link rel="prefetch" href="/assets/js/102.71e90b38.js"><link rel="prefetch" href="/assets/js/103.0b98b695.js"><link rel="prefetch" href="/assets/js/104.381cc2e1.js"><link rel="prefetch" href="/assets/js/105.cb84fa9a.js"><link rel="prefetch" href="/assets/js/106.4fdc69c7.js"><link rel="prefetch" href="/assets/js/107.16eaedc0.js"><link rel="prefetch" href="/assets/js/108.ea6dddbc.js"><link rel="prefetch" href="/assets/js/109.598b0639.js"><link rel="prefetch" href="/assets/js/11.c432b6eb.js"><link rel="prefetch" href="/assets/js/110.7220c89e.js"><link rel="prefetch" href="/assets/js/111.2b3126e1.js"><link rel="prefetch" href="/assets/js/112.0cf45bec.js"><link rel="prefetch" href="/assets/js/113.670b33aa.js"><link rel="prefetch" href="/assets/js/114.035474fa.js"><link rel="prefetch" href="/assets/js/115.647ef0d5.js"><link rel="prefetch" href="/assets/js/116.d0ef1802.js"><link rel="prefetch" href="/assets/js/117.9590c32f.js"><link rel="prefetch" href="/assets/js/118.cd29f214.js"><link rel="prefetch" href="/assets/js/119.f45ba982.js"><link rel="prefetch" href="/assets/js/12.89421195.js"><link rel="prefetch" href="/assets/js/120.285b2f75.js"><link rel="prefetch" href="/assets/js/121.42bdda64.js"><link rel="prefetch" href="/assets/js/122.786ece87.js"><link rel="prefetch" href="/assets/js/123.b719a590.js"><link rel="prefetch" href="/assets/js/124.89ec1081.js"><link rel="prefetch" href="/assets/js/125.f647d59f.js"><link rel="prefetch" href="/assets/js/126.1f059bfa.js"><link rel="prefetch" href="/assets/js/127.7080e4fd.js"><link rel="prefetch" href="/assets/js/128.eed89d4d.js"><link rel="prefetch" href="/assets/js/129.3728f81f.js"><link rel="prefetch" href="/assets/js/13.b6de05d0.js"><link rel="prefetch" href="/assets/js/130.ea0839fa.js"><link rel="prefetch" href="/assets/js/131.acf40a79.js"><link rel="prefetch" href="/assets/js/132.c620278a.js"><link rel="prefetch" href="/assets/js/133.be408261.js"><link rel="prefetch" href="/assets/js/134.17ebe9fb.js"><link rel="prefetch" href="/assets/js/135.f1acb61a.js"><link rel="prefetch" href="/assets/js/136.aee37c29.js"><link rel="prefetch" href="/assets/js/137.7239fdf5.js"><link rel="prefetch" href="/assets/js/138.afa53af9.js"><link rel="prefetch" href="/assets/js/139.9df069bf.js"><link rel="prefetch" href="/assets/js/14.2ca699ce.js"><link rel="prefetch" href="/assets/js/140.aba5c04e.js"><link rel="prefetch" href="/assets/js/141.b2933659.js"><link rel="prefetch" href="/assets/js/142.4fbc3c51.js"><link rel="prefetch" href="/assets/js/143.99613a5d.js"><link rel="prefetch" href="/assets/js/144.d86d8760.js"><link rel="prefetch" href="/assets/js/145.822da147.js"><link rel="prefetch" href="/assets/js/146.241a4513.js"><link rel="prefetch" href="/assets/js/147.74a7e1d1.js"><link rel="prefetch" href="/assets/js/148.5285f8ae.js"><link rel="prefetch" href="/assets/js/149.85aa58d5.js"><link rel="prefetch" href="/assets/js/15.5116fa33.js"><link rel="prefetch" href="/assets/js/150.c0e7296a.js"><link rel="prefetch" href="/assets/js/151.d8a13e66.js"><link rel="prefetch" href="/assets/js/152.9fdc407d.js"><link rel="prefetch" href="/assets/js/153.5c18588f.js"><link rel="prefetch" href="/assets/js/154.b6c29050.js"><link rel="prefetch" href="/assets/js/155.b11a434c.js"><link rel="prefetch" href="/assets/js/156.46af1206.js"><link rel="prefetch" href="/assets/js/157.e1d1db43.js"><link rel="prefetch" href="/assets/js/158.9a7833f8.js"><link rel="prefetch" href="/assets/js/159.acad34b9.js"><link rel="prefetch" href="/assets/js/16.25e3c7ff.js"><link rel="prefetch" href="/assets/js/160.04ba27c3.js"><link rel="prefetch" href="/assets/js/161.09eda579.js"><link rel="prefetch" href="/assets/js/162.ae9941c7.js"><link rel="prefetch" href="/assets/js/163.fb2499aa.js"><link rel="prefetch" href="/assets/js/164.9ccfbdae.js"><link rel="prefetch" href="/assets/js/165.62f33f9e.js"><link rel="prefetch" href="/assets/js/166.352e65c9.js"><link rel="prefetch" href="/assets/js/167.7a1b5587.js"><link rel="prefetch" href="/assets/js/168.f050f09a.js"><link rel="prefetch" href="/assets/js/169.a59378f6.js"><link rel="prefetch" href="/assets/js/17.d2db6c10.js"><link rel="prefetch" href="/assets/js/170.daf4026e.js"><link rel="prefetch" href="/assets/js/171.7ea70d2b.js"><link rel="prefetch" href="/assets/js/172.1896afe4.js"><link rel="prefetch" href="/assets/js/173.90f895a7.js"><link rel="prefetch" href="/assets/js/174.a976b8fe.js"><link rel="prefetch" href="/assets/js/175.81885e75.js"><link rel="prefetch" href="/assets/js/176.b5aa7e73.js"><link rel="prefetch" href="/assets/js/177.86be73ca.js"><link rel="prefetch" href="/assets/js/178.e32bd9dc.js"><link rel="prefetch" href="/assets/js/179.efc8f789.js"><link rel="prefetch" href="/assets/js/18.feca2e31.js"><link rel="prefetch" href="/assets/js/180.fb2aae1f.js"><link rel="prefetch" href="/assets/js/181.e2ee3c55.js"><link rel="prefetch" href="/assets/js/182.fec1a74c.js"><link rel="prefetch" href="/assets/js/183.2bfa5cb4.js"><link rel="prefetch" href="/assets/js/184.43b514a9.js"><link rel="prefetch" href="/assets/js/185.0363864c.js"><link rel="prefetch" href="/assets/js/186.b29f569a.js"><link rel="prefetch" href="/assets/js/187.2a1e8086.js"><link rel="prefetch" href="/assets/js/189.e8c4e346.js"><link rel="prefetch" href="/assets/js/19.5772c671.js"><link rel="prefetch" href="/assets/js/190.fab172ba.js"><link rel="prefetch" href="/assets/js/191.e39a0623.js"><link rel="prefetch" href="/assets/js/192.b532d7a9.js"><link rel="prefetch" href="/assets/js/193.79f1c8ad.js"><link rel="prefetch" href="/assets/js/194.58587468.js"><link rel="prefetch" href="/assets/js/195.2350e46a.js"><link rel="prefetch" href="/assets/js/196.8a58492c.js"><link rel="prefetch" href="/assets/js/197.816983e5.js"><link rel="prefetch" href="/assets/js/198.343f92c3.js"><link rel="prefetch" href="/assets/js/199.fa9c8c14.js"><link rel="prefetch" href="/assets/js/20.890e267f.js"><link rel="prefetch" href="/assets/js/200.8bfc8ff9.js"><link rel="prefetch" href="/assets/js/201.8ee41bd7.js"><link rel="prefetch" href="/assets/js/202.68af82d6.js"><link rel="prefetch" href="/assets/js/203.9b03956c.js"><link rel="prefetch" href="/assets/js/204.d9615429.js"><link rel="prefetch" href="/assets/js/205.9073e5ab.js"><link rel="prefetch" href="/assets/js/206.253639f3.js"><link rel="prefetch" href="/assets/js/207.43147ccd.js"><link rel="prefetch" href="/assets/js/208.e237d694.js"><link rel="prefetch" href="/assets/js/209.75685811.js"><link rel="prefetch" href="/assets/js/21.802af761.js"><link rel="prefetch" href="/assets/js/210.34fe9854.js"><link rel="prefetch" href="/assets/js/211.fba10f57.js"><link rel="prefetch" href="/assets/js/212.db4f523d.js"><link rel="prefetch" href="/assets/js/213.a36894cf.js"><link rel="prefetch" href="/assets/js/214.601e5fcd.js"><link rel="prefetch" href="/assets/js/215.e20ca028.js"><link rel="prefetch" href="/assets/js/216.2e263ce7.js"><link rel="prefetch" href="/assets/js/217.9f92c697.js"><link rel="prefetch" href="/assets/js/218.58232bbb.js"><link rel="prefetch" href="/assets/js/219.f93d35fd.js"><link rel="prefetch" href="/assets/js/22.713a2223.js"><link rel="prefetch" href="/assets/js/220.e14b60a3.js"><link rel="prefetch" href="/assets/js/221.5629e979.js"><link rel="prefetch" href="/assets/js/222.caf63459.js"><link rel="prefetch" href="/assets/js/223.06ec98d3.js"><link rel="prefetch" href="/assets/js/224.300260af.js"><link rel="prefetch" href="/assets/js/225.51f24ae4.js"><link rel="prefetch" href="/assets/js/226.30fc5f81.js"><link rel="prefetch" href="/assets/js/227.6a76a8aa.js"><link rel="prefetch" href="/assets/js/228.53c94137.js"><link rel="prefetch" href="/assets/js/229.97fc78d1.js"><link rel="prefetch" href="/assets/js/23.01eee2e9.js"><link rel="prefetch" href="/assets/js/230.11731b6a.js"><link rel="prefetch" href="/assets/js/231.4149d7ac.js"><link rel="prefetch" href="/assets/js/232.8ad4a9ea.js"><link rel="prefetch" href="/assets/js/233.470d1221.js"><link rel="prefetch" href="/assets/js/234.682aeaab.js"><link rel="prefetch" href="/assets/js/235.4eafd3b8.js"><link rel="prefetch" href="/assets/js/236.1d7af032.js"><link rel="prefetch" href="/assets/js/237.b19212be.js"><link rel="prefetch" href="/assets/js/238.25c7a000.js"><link rel="prefetch" href="/assets/js/239.7cbe93b2.js"><link rel="prefetch" href="/assets/js/24.1e0a0b36.js"><link rel="prefetch" href="/assets/js/240.8f299c01.js"><link rel="prefetch" href="/assets/js/241.b7fde5cc.js"><link rel="prefetch" href="/assets/js/242.698f142a.js"><link rel="prefetch" href="/assets/js/243.65f9db18.js"><link rel="prefetch" href="/assets/js/244.4a049e03.js"><link rel="prefetch" href="/assets/js/245.b2be032c.js"><link rel="prefetch" href="/assets/js/246.4677d61e.js"><link rel="prefetch" href="/assets/js/247.f62aa90c.js"><link rel="prefetch" href="/assets/js/248.512f5de2.js"><link rel="prefetch" href="/assets/js/249.a338cce4.js"><link rel="prefetch" href="/assets/js/25.3568c000.js"><link rel="prefetch" href="/assets/js/250.9052489d.js"><link rel="prefetch" href="/assets/js/251.57f05596.js"><link rel="prefetch" href="/assets/js/252.2f97ca34.js"><link rel="prefetch" href="/assets/js/253.cf41eb54.js"><link rel="prefetch" href="/assets/js/254.c3afc73d.js"><link rel="prefetch" href="/assets/js/255.654f2eea.js"><link rel="prefetch" href="/assets/js/256.d7759b82.js"><link rel="prefetch" href="/assets/js/257.5015c60f.js"><link rel="prefetch" href="/assets/js/258.bb4eda0e.js"><link rel="prefetch" href="/assets/js/259.32a931e0.js"><link rel="prefetch" href="/assets/js/26.02d83d85.js"><link rel="prefetch" href="/assets/js/260.b7b95348.js"><link rel="prefetch" href="/assets/js/261.5041cae9.js"><link rel="prefetch" href="/assets/js/262.56a85cbf.js"><link rel="prefetch" href="/assets/js/263.340f4259.js"><link rel="prefetch" href="/assets/js/264.0c23f349.js"><link rel="prefetch" href="/assets/js/265.cd426a43.js"><link rel="prefetch" href="/assets/js/266.ba8ee028.js"><link rel="prefetch" href="/assets/js/267.687fd70e.js"><link rel="prefetch" href="/assets/js/268.440d1b35.js"><link rel="prefetch" href="/assets/js/269.4b2f1f5e.js"><link rel="prefetch" href="/assets/js/27.ca08881a.js"><link rel="prefetch" href="/assets/js/270.d8fd28bc.js"><link rel="prefetch" href="/assets/js/271.e18c7d99.js"><link rel="prefetch" href="/assets/js/272.20aa884a.js"><link rel="prefetch" href="/assets/js/273.e08784f9.js"><link rel="prefetch" href="/assets/js/274.becf7599.js"><link rel="prefetch" href="/assets/js/275.f3cc6fdc.js"><link rel="prefetch" href="/assets/js/276.72f0c1d1.js"><link rel="prefetch" href="/assets/js/277.b03fa34f.js"><link rel="prefetch" href="/assets/js/278.d88afd52.js"><link rel="prefetch" href="/assets/js/279.1e2c7030.js"><link rel="prefetch" href="/assets/js/28.cb3cf26d.js"><link rel="prefetch" href="/assets/js/280.d6a967a4.js"><link rel="prefetch" href="/assets/js/281.6909525d.js"><link rel="prefetch" href="/assets/js/282.bf8d2fe4.js"><link rel="prefetch" href="/assets/js/283.9aa1b5da.js"><link rel="prefetch" href="/assets/js/284.dd695123.js"><link rel="prefetch" href="/assets/js/285.433ff207.js"><link rel="prefetch" href="/assets/js/286.046f6a90.js"><link rel="prefetch" href="/assets/js/287.b253f32a.js"><link rel="prefetch" href="/assets/js/288.5c19ecd4.js"><link rel="prefetch" href="/assets/js/289.a4022ef2.js"><link rel="prefetch" href="/assets/js/29.d1c409da.js"><link rel="prefetch" href="/assets/js/290.3747ee87.js"><link rel="prefetch" href="/assets/js/291.f0691e9e.js"><link rel="prefetch" href="/assets/js/292.9bda67e7.js"><link rel="prefetch" href="/assets/js/293.6dc2cb6c.js"><link rel="prefetch" href="/assets/js/294.38766377.js"><link rel="prefetch" href="/assets/js/295.1f9166a8.js"><link rel="prefetch" href="/assets/js/296.2f1e7e2d.js"><link rel="prefetch" href="/assets/js/297.870f08d1.js"><link rel="prefetch" href="/assets/js/298.5b7cc1d0.js"><link rel="prefetch" href="/assets/js/299.537c2d7b.js"><link rel="prefetch" href="/assets/js/30.b4d89b0c.js"><link rel="prefetch" href="/assets/js/300.ba7a6576.js"><link rel="prefetch" href="/assets/js/301.2bd69aaa.js"><link rel="prefetch" href="/assets/js/302.81aafd63.js"><link rel="prefetch" href="/assets/js/303.ef231b17.js"><link rel="prefetch" href="/assets/js/304.16d2fb9b.js"><link rel="prefetch" href="/assets/js/305.ee5f3cba.js"><link rel="prefetch" href="/assets/js/306.6da13861.js"><link rel="prefetch" href="/assets/js/307.723d5abf.js"><link rel="prefetch" href="/assets/js/308.f3545100.js"><link rel="prefetch" href="/assets/js/309.09b2e5d0.js"><link rel="prefetch" href="/assets/js/31.1c190f98.js"><link rel="prefetch" href="/assets/js/310.c53eaf6a.js"><link rel="prefetch" href="/assets/js/311.99de3b18.js"><link rel="prefetch" href="/assets/js/312.b4e4b4c7.js"><link rel="prefetch" href="/assets/js/313.7cf13b4a.js"><link rel="prefetch" href="/assets/js/314.11a5367f.js"><link rel="prefetch" href="/assets/js/315.a0ab68fe.js"><link rel="prefetch" href="/assets/js/316.4d50598e.js"><link rel="prefetch" href="/assets/js/317.e1c09ab6.js"><link rel="prefetch" href="/assets/js/318.9ab1142c.js"><link rel="prefetch" href="/assets/js/319.25f218b4.js"><link rel="prefetch" href="/assets/js/32.d4559216.js"><link rel="prefetch" href="/assets/js/320.d547a9a6.js"><link rel="prefetch" href="/assets/js/321.6cc576c7.js"><link rel="prefetch" href="/assets/js/322.a46f1722.js"><link rel="prefetch" href="/assets/js/323.be2aa12b.js"><link rel="prefetch" href="/assets/js/324.61a7c448.js"><link rel="prefetch" href="/assets/js/325.e3501d32.js"><link rel="prefetch" href="/assets/js/326.0db83289.js"><link rel="prefetch" href="/assets/js/327.3272b509.js"><link rel="prefetch" href="/assets/js/328.960c7126.js"><link rel="prefetch" href="/assets/js/329.b8b8a012.js"><link rel="prefetch" href="/assets/js/33.216b3be0.js"><link rel="prefetch" href="/assets/js/330.1d9bd71a.js"><link rel="prefetch" href="/assets/js/331.ca4a1c85.js"><link rel="prefetch" href="/assets/js/332.ded9d1f6.js"><link rel="prefetch" href="/assets/js/333.71c84880.js"><link rel="prefetch" href="/assets/js/334.1c5859fe.js"><link rel="prefetch" href="/assets/js/335.52bb1428.js"><link rel="prefetch" href="/assets/js/336.f4c6b380.js"><link rel="prefetch" href="/assets/js/337.3ca76556.js"><link rel="prefetch" href="/assets/js/338.d152971c.js"><link rel="prefetch" href="/assets/js/34.cf1241f6.js"><link rel="prefetch" href="/assets/js/35.fc57667c.js"><link rel="prefetch" href="/assets/js/36.e6f6cf9c.js"><link rel="prefetch" href="/assets/js/37.1c1f90ad.js"><link rel="prefetch" href="/assets/js/38.d84a42a4.js"><link rel="prefetch" href="/assets/js/39.7df319f1.js"><link rel="prefetch" href="/assets/js/4.fdee8e3d.js"><link rel="prefetch" href="/assets/js/40.76b2b273.js"><link rel="prefetch" href="/assets/js/41.9de5688e.js"><link rel="prefetch" href="/assets/js/42.6b1a1a76.js"><link rel="prefetch" href="/assets/js/43.ec707d76.js"><link rel="prefetch" href="/assets/js/44.d0383221.js"><link rel="prefetch" href="/assets/js/45.18f0eafc.js"><link rel="prefetch" href="/assets/js/46.75c3dd88.js"><link rel="prefetch" href="/assets/js/47.726d893b.js"><link rel="prefetch" href="/assets/js/48.935fb84c.js"><link rel="prefetch" href="/assets/js/49.476706ed.js"><link rel="prefetch" href="/assets/js/5.68343c1d.js"><link rel="prefetch" href="/assets/js/50.dc675a1b.js"><link rel="prefetch" href="/assets/js/51.9e134472.js"><link rel="prefetch" href="/assets/js/52.8cdff2d3.js"><link rel="prefetch" href="/assets/js/53.be728098.js"><link rel="prefetch" href="/assets/js/54.441ed9a3.js"><link rel="prefetch" href="/assets/js/55.3a2e4e7b.js"><link rel="prefetch" href="/assets/js/56.4dbfc2bc.js"><link rel="prefetch" href="/assets/js/57.adf8a099.js"><link rel="prefetch" href="/assets/js/58.505146aa.js"><link rel="prefetch" href="/assets/js/59.f51b66bf.js"><link rel="prefetch" href="/assets/js/6.59593fe0.js"><link rel="prefetch" href="/assets/js/60.d8c860c5.js"><link rel="prefetch" href="/assets/js/61.d900c212.js"><link rel="prefetch" href="/assets/js/62.34c6efad.js"><link rel="prefetch" href="/assets/js/63.dfac5ecb.js"><link rel="prefetch" href="/assets/js/64.608e1b18.js"><link rel="prefetch" href="/assets/js/65.c3323030.js"><link rel="prefetch" href="/assets/js/66.358afebc.js"><link rel="prefetch" href="/assets/js/67.defb0d13.js"><link rel="prefetch" href="/assets/js/68.b45bf9fa.js"><link rel="prefetch" href="/assets/js/69.1acaf575.js"><link rel="prefetch" href="/assets/js/7.c8016fb0.js"><link rel="prefetch" href="/assets/js/70.5ce18eb7.js"><link rel="prefetch" href="/assets/js/71.714606a9.js"><link rel="prefetch" href="/assets/js/72.cbd5c68e.js"><link rel="prefetch" href="/assets/js/73.717f76d7.js"><link rel="prefetch" href="/assets/js/74.97e66fea.js"><link rel="prefetch" href="/assets/js/75.9c0faa4a.js"><link rel="prefetch" href="/assets/js/76.24bbcbc2.js"><link rel="prefetch" href="/assets/js/77.f18aaf3d.js"><link rel="prefetch" href="/assets/js/78.3db8034f.js"><link rel="prefetch" href="/assets/js/79.b0e71647.js"><link rel="prefetch" href="/assets/js/8.5bb6630f.js"><link rel="prefetch" href="/assets/js/80.8f172678.js"><link rel="prefetch" href="/assets/js/81.078d995c.js"><link rel="prefetch" href="/assets/js/82.08a682bf.js"><link rel="prefetch" href="/assets/js/83.194fe986.js"><link rel="prefetch" href="/assets/js/84.9e209c2b.js"><link rel="prefetch" href="/assets/js/85.f8ffdc2b.js"><link rel="prefetch" href="/assets/js/86.200c062b.js"><link rel="prefetch" href="/assets/js/87.559d44a3.js"><link rel="prefetch" href="/assets/js/88.4b99b3f5.js"><link rel="prefetch" href="/assets/js/89.bd3a0c0e.js"><link rel="prefetch" href="/assets/js/9.b6620d05.js"><link rel="prefetch" href="/assets/js/90.aabcc232.js"><link rel="prefetch" href="/assets/js/91.be5f3869.js"><link rel="prefetch" href="/assets/js/92.376af7b6.js"><link rel="prefetch" href="/assets/js/93.4006e592.js"><link rel="prefetch" href="/assets/js/94.f6bb72b0.js"><link rel="prefetch" href="/assets/js/95.a041e37a.js"><link rel="prefetch" href="/assets/js/96.82c9a8b8.js"><link rel="prefetch" href="/assets/js/97.d0a5c2c6.js"><link rel="prefetch" href="/assets/js/98.243d3b19.js"><link rel="prefetch" href="/assets/js/99.55cdc29e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1a00f748.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>FShsq</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>From FE Arch、To Full Stack</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><!---->
            
          <!---->
          2021
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/me.jpg" alt="FShsq" class="logo"> <span class="site-name">FShsq</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      FE
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JS/" class="nav-link"><i class="undefined"></i>
  JS
</a></li><li class="dropdown-item"><!----> <a href="/HTML/" class="nav-link"><i class="undefined"></i>
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/Styles/" class="nav-link"><i class="undefined"></i>
  Styles
</a></li><li class="dropdown-item"><h4>Browser</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/BrowserCore/" class="nav-link"><i class="undefined"></i>
  BrCore(MP)
</a></li><li class="dropdown-subitem"><a href="/BrowserModel/" class="nav-link"><i class="undefined"></i>
  BrModel(MT)
</a></li></ul></li><li class="dropdown-item"><h4>React</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/React/" class="nav-link"><i class="undefined"></i>
  ReactBase
</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Vue/" class="nav-link"><i class="undefined"></i>
  VueBase
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      BE
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Nodejs</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Node/" class="nav-link router-link-active"><i class="undefined"></i>
  NodeBase
</a></li></ul></li><li class="dropdown-item"><h4>cPlus</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Cplus/" class="nav-link"><i class="undefined"></i>
  cPlus
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Proj
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Project/" class="nav-link"><i class="undefined"></i>
  Project
</a></li><li class="dropdown-item"><h4>toolsForProject</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Tools/" class="nav-link"><i class="undefined"></i>
  Git&amp;webpack
</a></li></ul></li><li class="dropdown-item"><h4>other-ology</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OtherOlogy/" class="nav-link"><i class="undefined"></i>
  English
</a></li></ul></li><li class="dropdown-item"><h4>W</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Interface/" class="nav-link"><i class="undefined"></i>
  interfaceEx
</a></li></ul></li><li class="dropdown-item"><h4>AI</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/AlgorithmAI/" class="nav-link"><i class="undefined"></i>
  AI
</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/me.jpg" alt="author-avatar" class="personal-img" data-v-828910c6> <!----> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>309</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>0</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      FE
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JS/" class="nav-link"><i class="undefined"></i>
  JS
</a></li><li class="dropdown-item"><!----> <a href="/HTML/" class="nav-link"><i class="undefined"></i>
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/Styles/" class="nav-link"><i class="undefined"></i>
  Styles
</a></li><li class="dropdown-item"><h4>Browser</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/BrowserCore/" class="nav-link"><i class="undefined"></i>
  BrCore(MP)
</a></li><li class="dropdown-subitem"><a href="/BrowserModel/" class="nav-link"><i class="undefined"></i>
  BrModel(MT)
</a></li></ul></li><li class="dropdown-item"><h4>React</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/React/" class="nav-link"><i class="undefined"></i>
  ReactBase
</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Vue/" class="nav-link"><i class="undefined"></i>
  VueBase
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      BE
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Nodejs</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Node/" class="nav-link router-link-active"><i class="undefined"></i>
  NodeBase
</a></li></ul></li><li class="dropdown-item"><h4>cPlus</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Cplus/" class="nav-link"><i class="undefined"></i>
  cPlus
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Proj
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Project/" class="nav-link"><i class="undefined"></i>
  Project
</a></li><li class="dropdown-item"><h4>toolsForProject</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Tools/" class="nav-link"><i class="undefined"></i>
  Git&amp;webpack
</a></li></ul></li><li class="dropdown-item"><h4>other-ology</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OtherOlogy/" class="nav-link"><i class="undefined"></i>
  English
</a></li></ul></li><li class="dropdown-item"><h4>W</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Interface/" class="nav-link"><i class="undefined"></i>
  interfaceEx
</a></li></ul></li><li class="dropdown-item"><h4>AI</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/AlgorithmAI/" class="nav-link"><i class="undefined"></i>
  AI
</a></li></ul></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>NodeBase</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Node/NodeBase/node-first.html" class="sidebar-link">初步学习Node</a></li><li><a href="/Node/NodeBase/GlobalObject.html" class="sidebar-link">全局对象</a></li><li><a href="/Node/NodeBase/Buffer.html" class="sidebar-link">使用Buffer类处理二进制数据</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NodeExtend</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc></h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><!---->
            
          <!---->
          2021
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">理解 Stream（流）</h1> <div data-v-1ff7123e><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="理解-stream-流"><a href="#理解-stream-流" class="header-anchor">#</a> 理解 Stream（流）</h1> <p>接触过 Node.js 的开发人员可能知道，流（Stream）这个概念比较难理解，也不太好处理。</p> <p>这篇文章就来帮你理解流的概念，以及如何使用它。别担心，一定会搞懂的。</p> <h2 id="流-stream-是什么"><a href="#流-stream-是什么" class="header-anchor">#</a> 流（Stream）是什么？</h2> <p>流（Stream）是驱动 Node.js 应用的基础概念之一。它是数据处理方法，用于按顺序将输入读写到输出中。</p> <p>流是一种处理读写文件、网络通信或任何端到端信息交换的有效方式。</p> <p>流的独特之处在于，它不像传统的程序那样一次将一个文件读入内存，而是逐块读取数据、处理其内容，而不是将其全部保存在内存中。</p> <p>这使得流在处理<strong>大量数据</strong>时非常强大，例如，文件可能大于你的空闲内存，不可能将整个文件读入内存来处理，这时候流就发挥作用了。</p> <p>我们以 YouTube 或 Netflix 等流媒体服务为例：这些服务不会让你立即下载完整的视频和音频，而是浏览器将视频作为连续流的数据块，可以做到用户立即收看。</p> <p>然而，流并不仅仅用来处理媒体或大数据，它还赋予了代码的“可组合性”。在设计时考虑到可组合性意味着几个组件可以以某种方式组合以产生相同类型的结果。在 Node.js 中，通过使用流将数据从其他更小的代码段中导入或导出，可以组成功能强大的代码段。</p> <h2 id="为什么要用流"><a href="#为什么要用流" class="header-anchor">#</a> 为什么要用流</h2> <p>与其他数据处理方法相比，流有两个主要优势：</p> <ol><li><strong>内存效率：</strong> 不需要加载大量的数据到内存就可以处理</li> <li><strong>时间效率：</strong> 一旦有了数据就开始处理，而不必等待传输完所有数据</li></ol> <h2 id="node-js-中的-4-种流-stream"><a href="#node-js-中的-4-种流-stream" class="header-anchor">#</a> Node.js 中的 4 种流（Stream）</h2> <ol><li><strong>可写流：</strong> 可写入数据的流。例如<code>fs.createWriteStream()</code> 可以使用流将数据写入文件。</li> <li><strong>可读流：</strong> 可读取数据的流。例如<code>fs.createReadStream()</code> 可以从文件读取内容。</li> <li><strong>双工流：</strong> 既可读又可写的流。例如 <code>net.Socket</code>。</li> <li><strong>转换流：</strong> 可以在数据写入和读取时修改或转换数据的流。例如，在文件压缩操作中，可以向文件写入压缩数据，并从文件中读取解压数据。</li></ol> <p>如果你用过 Node.js，可能已经遇到过流了。例如，在基于 Node.js 的 HTTP 服务器中，<code>request</code> 是可读流，<code>response</code> 是可写流。还有<code>fs</code> 模块，能同时处理可读和可写文件流。只要你用 Express，就是在使用流与客户端进行交互，流也被用于各种数据库连接驱动程序中，因为 TCP 套接字、TLS 堆栈和其他连接都是基于 Node.js 流的。</p> <h2 id="如何创建可读流"><a href="#如何创建可读流" class="header-anchor">#</a> 如何创建可读流</h2> <p>引入模块并初始化：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Stream <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> readableStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stream<span class="token punctuation">.</span>Readable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>初始化后就可以给它发送数据了：</p> <div class="language-js extra-class"><pre class="language-js"><code>readableStream<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'ping!'</span><span class="token punctuation">)</span>
readableStream<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'pong!'</span><span class="token punctuation">)</span>


</code></pre></div><h2 id="异步迭代器-async-iterator"><a href="#异步迭代器-async-iterator" class="header-anchor">#</a> 异步迭代器（async iterator）</h2> <p><strong>强烈建议在处理流时使用异步迭代器</strong>。异步迭代是一种异步检索数据容器内容的协议，意味着当前的“任务”可能在检索数据项之前暂停。另外，值得一提的是，流的异步迭代器的内部实现使用了 <code>readable</code>事件。</p> <p>当从可读的流读取数据时，可以使用 async iterator:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fs <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">logChunks</span><span class="token punctuation">(</span><span class="token parameter">readable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> chunk <span class="token keyword">of</span> readable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> readable <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>
  <span class="token string">'tmp/test.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>encoding<span class="token operator">:</span> <span class="token string">'utf8'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">logChunks</span><span class="token punctuation">(</span>readable<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Output:</span>
<span class="token comment">// 'This is a test!\n'</span>
</code></pre></div><p><strong>也可以在字符串中收集可读流的内容:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Readable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'stream'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">readableToString2</span><span class="token punctuation">(</span><span class="token parameter">readable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> chunk <span class="token keyword">of</span> readable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result <span class="token operator">+=</span> chunk<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> readable <span class="token operator">=</span> Readable<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Good morning!'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> encoding<span class="token operator">:</span> <span class="token string">'utf8'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">readableToString2</span><span class="token punctuation">(</span>readable<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'Good morning!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>注意，在本例中，我们必须使用异步函数，因为我们希望返回一个 Promise。</p> <p>记得不要将异步函数与 <code>EventEmitter</code> 搞混了，因为目前无法捕获从事件处理程序中发出的 rejection，从而导致难以跟踪 bug 和内存泄漏。当前的最佳实践是始终将异步函数的内容封装在 <code>try/catch</code> 块中并处理错误，但这很容易出错。<a href="https://github.com/nodejs/node/pull/27867" target="_blank" rel="noopener noreferrer">这个 pull request<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>就是为了解决这个问题，如果能加入到 Node 核心代码的话。</p> <h3 id="readable-from-从-iterables-创建可读流"><a href="#readable-from-从-iterables-创建可读流" class="header-anchor">#</a> Readable.from(): 从 iterables 创建可读流</h3> <p><code>stream.Readable.from(iterable, [options])</code> 是一个实用方法，用于从迭代器创建可读流，其中的 iterable 包含了数据。iterable 可以是同步迭代的，也可以是异步迭代的。<code>options</code> 是可选的，可以用于指定文本编码。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Readable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">'streams'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> readable <span class="token operator">=</span> Readable<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

readable<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="两种读取模式"><a href="#两种读取模式" class="header-anchor">#</a> 两种读取模式</h3> <p>根据 <a href="https://nodejs.org/api/stream.html#stream_stream" target="_blank" rel="noopener noreferrer">Streams API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，可读流有两种操作模式： <em>flowing</em> 和 <em>paused</em>。 无论流是处于流模式还是暂停模式，可读流都可以用对象模式或非对象模式。</p> <ul><li>在<strong>flowing 模式</strong>中，数据从底层系统自动读取，并通过 <code>EventEmitter</code> 接口以尽可能快的速度使用事件提供给应用程序。</li> <li>在<strong>paused 模式</strong>中，必须显式地调用 <code>stream.read()</code> 方法来从流中读取数据块。</li></ul> <p><strong>在 flowing 模式</strong>中，要从流中读取数据，可以监听 <code>data</code> 事件并绑定回调。当数据块可用时，可读流发出 <code>data</code> 事件并执行回调。代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> readerStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Create a readable stream</span>

readerStream<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'UTF8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Set the encoding to be utf8\. </span>

<span class="token comment">// 处理 stream 事件 --&gt; data, end, 和 error</span>
readerStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   data <span class="token operator">+=</span> chunk<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

readerStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

readerStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Program Ended&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>函数调用 <code>fs.createReadStream()</code> 提供了一个可读流。一开始，流处于静止状态。只要监听 <code>data</code> 事件并绑定回调，它就开始流动。然后，读取数据块并将其传递给回调。流的实现者可以决定 <code>data</code> 事件发出的频率。例如，HTTP 请求可以在每读取几 KB 数据时发出一个 <code>data</code> 事件。当你从文件中读取数据时，你可能会采取每读取一行就发出 <code>data</code> 事件。</p> <p>当没有更多的数据要读取(到达尾部)时，流就会发出 <code>end</code> 事件。在上面的代码中，我们监听了这个事件，以便在结束时得到通知。</p> <p>另外，如果出现错误，流将发出错误并通知。</p> <p><strong>在 paused 模式</strong>下，你只需要反复调用流实例上的 <code>read()</code>，直到每一块数据都被读取，如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> readableStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> chunk<span class="token punctuation">;</span>

readableStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'readable'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>chunk<span class="token operator">=</span>readableStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data <span class="token operator">+=</span> chunk<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

readableStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><code>read()</code> 函数从内部缓冲区读取一些数据并返回。当没有要读取的内容时，它返回 <code>null</code>。因此，在<code>while</code>循环中，我们检查<code>null</code>并终止循环。请注意，<code>readable</code>事件是在可以从流中读取数据块时发出的。</p> <p>所有<code>Readable</code>数据流都以 <strong>paused 模式</strong>开始，但可以通过以下方式切换到 <strong>flowing 模式</strong>：</p> <ul><li>添加 <code>data</code> 事件处理器</li> <li>调用 <code>stream.resume()</code> 方法</li> <li>调用 <code>stream.pipe()</code> 方法发送数据到一个 <code>Writable</code></li></ul> <p><code>Readable</code>可以使用以下几种方式切换回 paused 模式:</p> <ul><li>如果没有管道（pipe）目标，调用<code>stream.pause()</code>方法</li> <li>如果有管道（pipe）目标，删除所有管道目标。可以通过调用 <code>stream.unpipe()</code> 方法来删除多个管道目标。</li></ul> <p>要记住的重要概念是，除非提供了一种用于消费或忽略该数据的机制，否则<code>Readable</code> 将不会生成数据。如果消费机制被禁用或取消，<code>Readable</code>将<em>尝试</em>停止生成数据。 添加一个<code>readable</code> 事件处理程序会自动使流停止流动，并通过<code>readable.read()</code>消费数据。如果删除了<code>readable</code>事件处理程序，那么如果存在<code>data</code>事件处理程序，则流就会再次开始流动。</p> <h2 id="如何创建可写流"><a href="#如何创建可写流" class="header-anchor">#</a> 如何创建可写流</h2> <p>要将数据写入可写流，你需要在流实例上调用<code>write()</code>。 如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> readableStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'file1.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> writableStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'file2.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

readableStream<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

readableStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    writableStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的代码简单直白。它只是简单地从输入流中读取数据块，并使用<code>write()</code>写入目标位置。该函数返回一个布尔值，表明操作是否成功。如果为true，则写入成功，你可以继续写入更多数据。 如果返回 false，则表示出了点问题，目前无法写入任何内容。可写流将通过发出<code>drain</code>事件来通知你何时可以开始写入更多数据。</p> <p>调用<code>writable.end()</code>方法表明没有更多数据将被写入<code>Writable</code>。 如果提供可选的回调函数，将作为<code>finish</code>事件的监听器函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 写入 'hello, ' 然后以 'world!' 结束</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> file <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'example.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'hello, '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
file<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 不允许写更多内容！</span>
</code></pre></div><p><strong>使用可写流，你可以从可读流中读取数据：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Stream <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> readableStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stream<span class="token punctuation">.</span>Readable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> writableStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stream<span class="token punctuation">.</span>Writable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

writableStream<span class="token punctuation">.</span><span class="token function-variable function">_write</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">chunk<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

readableStream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writableStream<span class="token punctuation">)</span>

readableStream<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'ping!'</span><span class="token punctuation">)</span>
readableStream<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'pong!'</span><span class="token punctuation">)</span>

writableStream<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>你还可以使用异步迭代器写入可写流，这也是建议的做法：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> util <span class="token keyword">from</span> <span class="token string">'util'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> stream <span class="token keyword">from</span> <span class="token string">'stream'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fs <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>once<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'events'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> finished <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span>stream<span class="token punctuation">.</span>finished<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (A)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">writeIterableToFile</span><span class="token punctuation">(</span><span class="token parameter">iterable<span class="token punctuation">,</span> filePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> writable <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token punctuation">{</span>encoding<span class="token operator">:</span> <span class="token string">'utf8'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> chunk <span class="token keyword">of</span> iterable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>writable<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// (B)</span>
      <span class="token comment">// 处理反压</span>
      <span class="token keyword">await</span> <span class="token function">once</span><span class="token punctuation">(</span>writable<span class="token punctuation">,</span> <span class="token string">'drain'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  writable<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (C)</span>
  <span class="token comment">// 等待完成，如果有错误则抛出</span>
  <span class="token keyword">await</span> <span class="token function">finished</span><span class="token punctuation">(</span>writable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">await</span> <span class="token function">writeIterableToFile</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span><span class="token string">'One'</span><span class="token punctuation">,</span> <span class="token string">' line of text.\n'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'tmp/log.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>
  fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'tmp/log.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>encoding<span class="token operator">:</span> <span class="token string">'utf8'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'One line of text.\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>stream.finished()</code>的默认版本是基于回调的，但是可以通过<code>util.promisify()</code>转换为基于 Promise 的版本（A行）。</p> <p>在此示例中，使用了以下两种模式：</p> <p>写入可写流，同时处理反压（短时负载高峰导致系统接收数据的速率远高于它处理数据的速率）（B行）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>writable<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">once</span><span class="token punctuation">(</span>writable<span class="token punctuation">,</span> <span class="token string">'drain'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>关闭可写流，并等待写入完成（C行）：</p> <div class="language-js extra-class"><pre class="language-js"><code>writable<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> <span class="token function">finished</span><span class="token punctuation">(</span>writable<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="pipeline"><a href="#pipeline" class="header-anchor">#</a> pipeline()</h2> <p>管道是一种机制，是将一个流的输出作为另一流的输入。它通常用于从一个流中获取数据并将该流的输出传递到另外的流。管道操作没有限制，换句话说，管道用于分步骤处理流数据。</p> <p>Node 10.x 引入了<code>stream.pipeline()</code>。 这是一种模块方法，用于在流之间进行管道传输，转发错误信息和数据清理，并在管道完成后提供回调。</p> <p>下面是使用 pipeline 的一个例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> pipeline <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> zlib <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'zlib'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用 pipeline API 轻松管理多个管道流，并且在管道全部完成时得到通知</span>
<span class="token comment">// 一个用来高效压缩超大视频文件的管道</span>

<span class="token function">pipeline</span><span class="token punctuation">(</span>
  fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'The.Matrix.1080p.mkv'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  zlib<span class="token punctuation">.</span><span class="token function">createGzip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'The.Matrix.1080p.mkv.gz'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Pipeline failed'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Pipeline succeeded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre></div><p>应该使用<code>pipeline</code> 而不是 <code>pipe</code>，因为<code>pipe</code>是不安全的。</p> <h2 id="stream-模块"><a href="#stream-模块" class="header-anchor">#</a> Stream 模块</h2> <p><a href="https://nodejs.org/api/stream.html" target="_blank" rel="noopener noreferrer">Node.js stream 模块<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是构建所有流 API 的基础。</p> <p>Stream 模块是 Node.js 中默认提供的内建模块。 Stream 是 EventEmitter 类的实例，该类在Node 中用于异步处理事件。 因此，流本质上是基于事件的。</p> <p>使用stream模块只需：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> stream <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre></div><p><code>stream</code> 模块对于创建新型流实例非常有用。通常没有必要使用<code>stream</code>模块来消费流。</p> <h2 id="基于流的-node-js-api"><a href="#基于流的-node-js-api" class="header-anchor">#</a> 基于流的 Node.js API</h2> <p>由于它们的优点，Node.js 许多核心模块提供了原生流处理功能，最值得注意的是这些：</p> <ul><li><code>net.Socket</code> 基于流的主要 node api，是以下大部分 API 的基础</li> <li><code>process.stdin</code> 返回连接到 stdin 的流</li> <li><code>process.stdout</code>返回连接到 stdout 的流</li> <li><code>process.stderr</code> 返回连接到 stderr 的流</li> <li><code>fs.createReadStream()</code> 创建一个文件可读流</li> <li><code>fs.createWriteStream()</code> 创建一个文件可写流</li> <li><code>net.connect()</code> 初始化一个基于流的连接</li> <li><code>http.request()</code> 返回 <code>http.ClientRequest</code>类的一个实例，是一个可写流</li> <li><code>zlib.createGzip()</code> 用 gzip (一种压缩算法)将数据压缩到流</li> <li><code>zlib.createGunzip()</code> 解压 gzip 流</li> <li><code>zlib.createDeflate()</code> 用 deflate (一种压缩算法)将数据压缩到流</li> <li><code>zlib.createInflate()</code> 解压 deflate 流</li></ul> <h2 id="streams-备忘单"><a href="#streams-备忘单" class="header-anchor">#</a> Streams 备忘单</h2> <table><thead><tr><th>类型</th> <th>功能</th></tr></thead> <tbody><tr><td><code>Readable</code></td> <td>数据提供者</td></tr> <tr><td><code>Writable</code></td> <td>数据接收者</td></tr> <tr><td><code>Transform</code></td> <td>提供者和接收者</td></tr> <tr><td><code>Duplex</code></td> <td>提供者和接收者（独立的）</td></tr></tbody></table> <p>更多内容请查阅文档: <a href="https://nodejs.org/api/stream.html#stream_stream" target="_blank" rel="noopener noreferrer">Stream<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <em>(nodejs.org)</em></p> <h4 id="streams"><a href="#streams" class="header-anchor">#</a> Streams</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Readable <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Readable
<span class="token keyword">const</span> Writable <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Writable
<span class="token keyword">const</span> Transform <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Transform


</code></pre></div><h4 id="管道-piping"><a href="#管道-piping" class="header-anchor">#</a> 管道 Piping</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token comment">// 可读流</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">xformer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// 转换流</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">renderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 可写流</span>


</code></pre></div><h4 id="方法"><a href="#方法" class="header-anchor">#</a> 方法</h4> <div class="language-js extra-class"><pre class="language-js"><code>stream<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token comment">/*...*/</span><span class="token punctuation">)</span>         <span class="token comment">// Emit a chunk</span>
stream<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span>  <span class="token comment">// Raise an error</span>
stream<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>            <span class="token comment">// Close a stream</span>


</code></pre></div><h4 id="事件"><a href="#事件" class="header-anchor">#</a> 事件</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> st <span class="token operator">=</span> <span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 假设 source() 是可读流</span>
st<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'&lt;-'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
st<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
st<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'** bye'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
st<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'finish'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'** bye'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>


</code></pre></div><h4 id="flowing-模式"><a href="#flowing-模式" class="header-anchor">#</a> Flowing 模式</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 开启和关闭 flowing 模式</span>
st<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
st<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 自动开启 flowing 模式</span>
st<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token comment">/*...*/</span><span class="token punctuation">)</span>


</code></pre></div><h4 id="可读流"><a href="#可读流" class="header-anchor">#</a> 可读流</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">clock</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> stream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Readable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    objectMode<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 自己实现 read() 方法，如果要按需读取</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    stream<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> time<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> stream
<span class="token punctuation">}</span>

</code></pre></div><blockquote><p>可读流是数据生成器，用<code>stream.push()</code>写入数据。</p></blockquote> <h4 id="转换流"><a href="#转换流" class="header-anchor">#</a> 转换流</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">xformer</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Transform</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    objectMode<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">transform</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> _<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token operator">...</span>data<span class="token punctuation">,</span> index<span class="token operator">:</span> count<span class="token operator">++</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


</code></pre></div><blockquote><p>将转换后的数据块传给 <code>done(null, chunk)</code>.</p></blockquote> <h4 id="可写流"><a href="#可写流" class="header-anchor">#</a> 可写流</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">renderer</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Writable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    objectMode<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">write</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> _<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'&lt;-'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
      <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


</code></pre></div><h4 id="全部串起来"><a href="#全部串起来" class="header-anchor">#</a> 全部串起来</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token comment">// 可读流</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">xformer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// 转换流</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">renderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 可写流</span>


</code></pre></div><p>以下是与可写流相关的一些重要事件：</p> <ul><li><code>error</code> – 在写入/管道操作发生了错误时发送</li> <li><code>pipeline</code> – 当将可读流传递到可写流中时，可写流会发出此事件。</li> <li><code>unpipe</code> – 当你在可读流上调用<code>unpipe</code>并停止将其输送到目标流中时发出。</li></ul> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>这就是所有关于流的基础知识。 流、管道和链式操作是 Node.js 的核心和最强大的功能。流确实可以帮助你编写简洁而高效的代码来操作 I/O。</p> <p>此外，还有一个值得期待的<a href="https://github.com/nodejs/TSC/blob/master/Strategic-Initiatives.md#current-initiatives" target="_blank" rel="noopener noreferrer">Node.js战略计划<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>叫做<a href="https://github.com/Fishrock123/bob" target="_blank" rel="noopener noreferrer">BOB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，目标是改善 Node.js 的流数据接口，既可应用于 Node.js 内部核心，将来还有希望用于公开 API。</p></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/Node/NodeBase/Stream.html#流-stream-是什么" class="sidebar-link reco-side-流-stream-是什么" data-v-70334359>流（Stream）是什么？</a></li><li class="level-2" data-v-70334359><a href="/Node/NodeBase/Stream.html#为什么要用流" class="sidebar-link reco-side-为什么要用流" data-v-70334359>为什么要用流</a></li><li class="level-2" data-v-70334359><a href="/Node/NodeBase/Stream.html#node-js-中的-4-种流-stream" class="sidebar-link reco-side-node-js-中的-4-种流-stream" data-v-70334359>Node.js 中的 4 种流（Stream）</a></li><li class="level-2" data-v-70334359><a href="/Node/NodeBase/Stream.html#如何创建可读流" class="sidebar-link reco-side-如何创建可读流" data-v-70334359>如何创建可读流</a></li><li class="level-2" data-v-70334359><a href="/Node/NodeBase/Stream.html#异步迭代器-async-iterator" class="sidebar-link reco-side-异步迭代器-async-iterator" data-v-70334359>异步迭代器（async iterator）</a></li><li class="level-3" data-v-70334359><a href="/Node/NodeBase/Stream.html#readable-from-从-iterables-创建可读流" class="sidebar-link reco-side-readable-from-从-iterables-创建可读流" data-v-70334359>Readable.from(): 从 iterables 创建可读流</a></li><li class="level-3" data-v-70334359><a href="/Node/NodeBase/Stream.html#两种读取模式" class="sidebar-link reco-side-两种读取模式" data-v-70334359>两种读取模式</a></li><li class="level-2" data-v-70334359><a href="/Node/NodeBase/Stream.html#如何创建可写流" class="sidebar-link reco-side-如何创建可写流" data-v-70334359>如何创建可写流</a></li><li class="level-2" data-v-70334359><a href="/Node/NodeBase/Stream.html#pipeline" class="sidebar-link reco-side-pipeline" data-v-70334359>pipeline()</a></li><li class="level-2" data-v-70334359><a href="/Node/NodeBase/Stream.html#stream-模块" class="sidebar-link reco-side-stream-模块" data-v-70334359>Stream 模块</a></li><li class="level-2" data-v-70334359><a href="/Node/NodeBase/Stream.html#基于流的-node-js-api" class="sidebar-link reco-side-基于流的-node-js-api" data-v-70334359>基于流的 Node.js API</a></li><li class="level-2" data-v-70334359><a href="/Node/NodeBase/Stream.html#streams-备忘单" class="sidebar-link reco-side-streams-备忘单" data-v-70334359>Streams 备忘单</a></li><li class="level-2" data-v-70334359><a href="/Node/NodeBase/Stream.html#总结" class="sidebar-link reco-side-总结" data-v-70334359>总结</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.685bc563.js" defer></script><script src="/assets/js/3.20a26f39.js" defer></script><script src="/assets/js/1.027a0825.js" defer></script><script src="/assets/js/188.01a616f2.js" defer></script>
  </body>
</html>
