(window.webpackJsonp=window.webpackJsonp||[]).push([[100],{611:function(t,e,n){"use strict";n.r(e);var a=n(6),s=Object(a.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"javascript专题之跟着underscore学防抖"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#javascript专题之跟着underscore学防抖"}},[t._v("#")]),t._v(" JavaScript专题之跟着underscore学防抖")]),t._v(" "),n("blockquote",[n("p",[t._v("JavaScript 专题系列第一篇，讲解防抖，带你从零实现一个 underscore 的 debounce 函数")])]),t._v(" "),n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),n("p",[t._v("在前端开发中会遇到一些频繁的事件触发，比如：")]),t._v(" "),n("ol",[n("li",[t._v("window 的 resize、scroll")]),t._v(" "),n("li",[t._v("mousedown、mousemove")]),t._v(" "),n("li",[t._v("keyup、keydown\n……")])]),t._v(" "),n("p",[t._v("为此，我们举个示例代码来了解事件如何频繁的触发：")]),t._v(" "),n("p",[t._v("我们写个 "),n("code",[t._v("index.html")]),t._v(" 文件：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('<!DOCTYPE html>\n<html lang="zh-cmn-Hans">\n\n<head>\n    <meta charset="utf-8">\n    <meta http-equiv="x-ua-compatible" content="IE=edge, chrome=1">\n    <title>debounce</title>\n    <style>\n        #container{\n            width: 100%; height: 200px; line-height: 200px; text-align: center; color: #fff; background-color: #444; font-size: 30px;\n        }\n    </style>\n</head>\n\n<body>\n    <div id="container"></div>\n    <script src="debounce.js"><\/script>\n</body>\n\n</html>复制代码\n')])])]),n("p",[n("code",[t._v("debounce.js")]),t._v(" 文件的代码如下：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("var count = 1;\nvar container = document.getElementById('container');\n\nfunction getUserAction() {\n    container.innerHTML = count++;\n};\n\n\ncontainer.onmousemove = getUserAction;\n")])])]),n("p",[t._v("从左边滑到右边就触发了 165 次 getUserAction 函数！")]),t._v(" "),n("p",[t._v("因为这个例子很简单，所以浏览器完全反应的过来，可是如果是复杂的回调函数或是 ajax 请求呢？假设 1 秒触发了 60 次，每个回调就必须在 1000 / 60 = 16.67ms 内完成，否则就会有卡顿出现。")]),t._v(" "),n("p",[t._v("为了解决这个问题，一般有两种解决方案：")]),t._v(" "),n("ol",[n("li",[t._v("debounce 防抖")]),t._v(" "),n("li",[t._v("throttle 节流")])]),t._v(" "),n("h2",{attrs:{id:"防抖"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#防抖"}},[t._v("#")]),t._v(" 防抖")]),t._v(" "),n("p",[t._v("今天重点讲讲防抖的实现。")]),t._v(" "),n("p",[t._v("防抖的原理就是：你尽管触发事件，但是我一定在事件触发 n 秒后才执行，如果你在一个事件触发的 n 秒内又触发了这个事件，那我就以新的事件的时间为准，n 秒后才执行，总之，就是要等你触发完事件 n 秒内不再触发事件，我才执行，真是任性呐!")]),t._v(" "),n("h2",{attrs:{id:"第一版"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第一版"}},[t._v("#")]),t._v(" 第一版")]),t._v(" "),n("p",[t._v("根据这段表述，我们可以写第一版的代码：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("// 第一版\nfunction debounce(func, wait) {\n    var timeout;\n    return function () {\n        clearTimeout(timeout)\n        timeout = setTimeout(func, wait);\n    }\n}复制代码\n")])])]),n("p",[t._v("如果我们要使用它，以最一开始的例子为例：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("container.onmousemove = debounce(getUserAction, 1000);复制代码\n")])])]),n("p",[t._v("现在随你怎么移动，反正你移动完 1000ms 内不再触发，我再执行事件。")]),t._v(" "),n("p",[t._v("顿时就从 165 次降低成了 1 次!")]),t._v(" "),n("p",[t._v("棒棒哒，我们接着完善它。")]),t._v(" "),n("h2",{attrs:{id:"this"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#this"}},[t._v("#")]),t._v(" this")]),t._v(" "),n("p",[t._v("如果我们在 "),n("code",[t._v("getUserAction")]),t._v(" 函数中 "),n("code",[t._v("console.log(this)")]),t._v("，在不使用 "),n("code",[t._v("debounce")]),t._v(" 函数的时候，"),n("code",[t._v("this")]),t._v(" 的值为：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('<div id="container"></div>复制代码\n')])])]),n("p",[t._v("但是如果使用我们的 debounce 函数，this 就会指向 Window 对象！")]),t._v(" "),n("p",[t._v("所以我们需要将 this 指向正确的对象。")]),t._v(" "),n("p",[t._v("我们修改下代码：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("// 第二版\nfunction debounce(func, wait) {\n    var timeout;\n\n    return function () {\n        var context = this;\n\n        clearTimeout(timeout)\n        timeout = setTimeout(function(){\n            func.apply(context)\n        }, wait);\n    }\n}复制代码\n")])])]),n("p",[t._v("现在 this 已经可以正确指向了。让我们看下个问题：")]),t._v(" "),n("h2",{attrs:{id:"event-对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#event-对象"}},[t._v("#")]),t._v(" event 对象")]),t._v(" "),n("p",[t._v("JavaScript 在事件处理函数中会提供事件对象 event，我们修改下 getUserAction 函数：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("function getUserAction(e) {\n    console.log(e);\n    container.innerHTML = count++;\n};复制代码\n")])])]),n("p",[t._v("如果我们不使用 debouce 函数，这里会打印 MouseEvent 对象")]),t._v(" "),n("p",[t._v("但是在我们实现的 debounce 函数中，却只会打印 undefined!")]),t._v(" "),n("p",[t._v("所以我们再修改一下代码：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("// 第三版\nfunction debounce(func, wait) {\n    var timeout;\n\n    return function () {\n        var context = this;\n        var args = arguments;\n\n        clearTimeout(timeout)\n        timeout = setTimeout(function(){\n            func.apply(context, args)\n        }, wait);\n    }\n}复制代码\n")])])]),n("h2",{attrs:{id:"返回值"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#返回值"}},[t._v("#")]),t._v(" 返回值")]),t._v(" "),n("p",[t._v("再注意一个小点，getUserAction 函数可能是有返回值的，所以我们也要返回函数的执行结果")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("// 第四版\nfunction debounce(func, wait) {\n    var timeout, result;\n\n    return function () {\n        var context = this;\n        var args = arguments;\n\n        clearTimeout(timeout)\n        timeout = setTimeout(function(){\n            result = func.apply(context, args)\n        }, wait);\n\n        return result;\n    }\n}复制代码\n")])])]),n("p",[t._v("到此为止，我们修复了三个小问题：")]),t._v(" "),n("ol",[n("li",[t._v("this 指向")]),t._v(" "),n("li",[t._v("event 对象")]),t._v(" "),n("li",[t._v("返回值")])]),t._v(" "),n("h2",{attrs:{id:"立刻执行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#立刻执行"}},[t._v("#")]),t._v(" 立刻执行")]),t._v(" "),n("p",[t._v("这个时候，代码已经很是完善，但是为了让这个函数更加完善，我们接下来思考一个新的需求。")]),t._v(" "),n("p",[t._v("这个需求就是：")]),t._v(" "),n("p",[t._v("我不希望非要等到事件停止触发后才执行，我希望立刻执行函数，然后等到停止触发n秒后，才可以重新触发执行。")]),t._v(" "),n("p",[t._v("想想这个需求也是很有道理的嘛，那我们加个 immediate 参数判断是否是立刻执行。")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("// 第五版\nfunction debounce(func, wait, immediate) {\n\n    var timeout, result;\n\n    return function () {\n        var context = this;\n        var args = arguments;\n\n        if (timeout) clearTimeout(timeout);\n        if (immediate) {\n            // 如果已经执行过，不再执行\n            var callNow = !timeout;\n            timeout = setTimeout(function(){\n                timeout = null;\n            }, wait)\n            if (callNow) result = func.apply(context, args)\n        }\n        else {\n            timeout = setTimeout(function(){\n                result = func.apply(context, args)\n            }, wait);\n        }\n\n        return result;\n    }\n}复制代码\n")])])]),n("h2",{attrs:{id:"取消"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#取消"}},[t._v("#")]),t._v(" 取消")]),t._v(" "),n("p",[t._v("最后我们再思考一个小需求，我希望能取消 debounce 函数，比如说我 debounce 的时间间隔是 10 秒钟，immediate 为 true，这样的话，我只有等 10 秒后才能重新触发事件，现在我希望有一个按钮，点击后，取消防抖，这样我再去触发，就可以又立刻执行啦，是不是很开心？")]),t._v(" "),n("p",[t._v("为了这个需求，我们写最后一版的代码：")]),t._v(" "),n("p",[t._v("至此我们已经完整实现了一个 underscore 中的 debounce 函数，恭喜，撒花！")]),t._v(" "),n("h2",{attrs:{id:"专题系列"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#专题系列"}},[t._v("#")]),t._v(" 专题系列")]),t._v(" "),n("p",[t._v("JavaScript专题系列目录地址："),n("a",{attrs:{href:"https://github.com/mqyqingfeng/Blog",target:"_blank",rel:"noopener noreferrer"}},[t._v("github.com/mqyqingfeng…"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("p",[t._v("JavaScript专题系列预计写二十篇左右，主要研究日常开发中一些功能点的实现，比如防抖、节流、去重、类型判断、拷贝、最值、扁平、柯里、递归、乱序、排序等，特点是研(chao)究(xi) underscore 和 jQuery 的实现方式。")])])}),[],!1,null,null,null);e.default=s.exports}}]);